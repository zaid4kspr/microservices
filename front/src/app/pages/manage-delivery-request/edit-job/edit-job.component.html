<div class="layout-px-spacing" *ngIf="requestDelivery">

    <div class="">
        <div class="row">
            <div class="col-md-5 pr-md-0 zIndex ">
                <form [formGroup]="requestDelivery">
                    <div class=" leftpart h-100 px-3 pt-3">
                        <div class="card " *ngIf="jobType==1">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h4>Pick Up</h4>
                                    </div>
                                </div>


                                <div formGroupName="pickUp">
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <input [ngClass]="{ 'is-invalid': submitted && (f.pickUp.controls.pickUpAddress.errors||
                                                    f.pickUp.controls.longitude.errors 
                                                    ||f.pickUp.controls.latitude.errors)  }"
                                                    formControlName="pickUpAddress" class="form-control "
                                                    matGoogleMapsAutocomplete country="tn"
                                                    [value]="f.pickUp.controls.pickUpAddress.value"
                                                    (onAutocompleteSelected)="onPickUpAutocompleteSelected($event)"
                                                    (onLocationSelected)="onPickUpLocationSelected($event)"
                                                    (keyup)="pickUpInputChanged($event)">


                                                <small class="text-danger"
                                                    *ngIf="f.pickUp.controls.pickUpAddress.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                                <div>
                                                    <small>
                                                        {{'LIVRAISON.PICKUP_HELPER'| translate}}
                                                    </small>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <!-- <div class="row mt-2">
                                        <div class="col-1">
                                            <div class="form-group">
                                                <input class="" type="checkbox" name="exactPickUpAddress" formControlName="exactPickUpAddress">
                                            </div>
                                        </div>
                                        <div class="col-10">
                                            <div class="form-group">
                                                <label class="form-check-label" for="exactPickUpAddress">{{ 'LIVRAISON.EXACT_ADDRESS'|translate }}</label>
                                            </div>
                                        </div>
                                    </div> -->
                                </div>

                                <div class="row mt-0">

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div>
                                                <label for="degree2">{{ 'GENERAL.DATE'|translate}}</label>
                                            </div>
                                            <div>
                                                <dp-date-picker
                                                    [ngClass]="{ 'is-invalid': submitted && f.startDate.errors }"
                                                    formControlName="startDate" theme="dp-material"
                                                    [config]="datePickerConfig">
                                                </dp-date-picker>
                                                <small class="text-danger" *ngIf="f.startDate.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <div>
                                                <label for="degree2">{{ 'CONCIERGERIE.FROMTO'|translate}}</label>
                                            </div>
                                            <div class="">
                                                <select [ngClass]="{ 'is-invalid': submitted &&  f.fromTo.errors}"
                                                    formControlName="fromTo" class="form-control ">
                                                    <option selected="selected" disabled value="">
                                                        {{ 'CONCIERGERIE.FROMTO'|translate }}</option>
                                                    <option value="08:00-12:00">08:00 To 12:00</option>
                                                    <option value="12:00-16:00">12:00 To 16:00</option>
                                                    <option value="16:00-20:00">16:00 To 20:00</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <select class="form-control  "
                                            [ngClass]="{ 'is-invalid': submitted && f.paymentStatus.errors }"
                                            formControlName="paymentStatus">
                                            <option selected="selected" disabled value="">
                                                {{'LIVRAISON.SELECT_PAYMENT' | translate}}
                                            </option>
                                            <option value="1">
                                                {{'LIVRAISON.PAYED' | translate}}
                                            </option>
                                            <option value="2" (click)="showAmountBox()">
                                                {{'LIVRAISON.COLLECT' | translate}}
                                            </option>
                                        </select>
                                        <small class="text-danger" *ngIf="f.paymentStatus.hasError('required')">
                                            Ce champ est obligatoire.
                                        </small>
                                    </div>
                                </div>
                                <div class="row mt-2" *ngIf="f.paymentStatus.value==2">
                                    <div class="col-12">
                                        <div class="form-group">
                                            <input [ngClass]="{ 'is-invalid': submitted && f.amount.errors }"
                                                formControlName="amount" class="form-control "
                                                pattern="^[0-9]+(\.[0-9]{1,2})?$"
                                                placeholder="{{ 'LIVRAISON.AMOUNT' | translate }}">
                                            <small class="text-danger" *ngIf="f.amount.hasError('required')">
                                                Ce champ est obligatoire.
                                            </small>
                                            <small class="text-danger" *ngIf="f.amount.hasError('pattern')">
                                                This field is numeric
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <select class="form-control  "
                                            [ngClass]="{ 'is-invalid': submitted && f.status.errors }"
                                            formControlName="status">
                                            <option selected="selected" disabled value="">
                                                Status
                                            </option>
                                            <option value={{item.value}} *ngFor="let item of status">
                                                {{item.name}}
                                            </option>

                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card mt-2" *ngIf="jobType==2">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h4>Drop off</h4>
                                    </div>
                                </div>
                                <div formGroupName="dropOff">
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <input [ngClass]="{ 'is-invalid': submitted && (f.dropOff.controls.dropOffAddress.errors||
                                                    f.dropOff.controls.longitude.errors 
                                                    ||f.dropOff.controls.latitude.errors)}"
                                                    formControlName="dropOffAddress" class="form-control "
                                                    matGoogleMapsAutocomplete country="tn"
                                                    (onAutocompleteSelected)="onDropOffAutocompleteSelected($event)"
                                                    (onLocationSelected)="onDropOffLocationSelected($event)"
                                                    [value]="f.dropOff.controls.dropOffAddress.value"
                                                    (keyup)="dropOffInputChanged($event)">
                                                <small class="text-danger"
                                                    *ngIf="f.dropOff.controls.dropOffAddress.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-1">
                                            <div class="form-group">
                                                <input class="" type="checkbox" name="exactDropOffAddress"
                                                    formControlName="exactDropOffAddress">
                                            </div>
                                        </div>
                                        <div class="col-10">
                                            <div class="form-group">
                                                <label class="form-check-label"
                                                    for="exactDropOffAddress">{{ 'LIVRAISON.EXACT_ADDRESS'|translate }}</label>
                                                    <div>
                                                        <small>
                                                            {{'LIVRAISON.EXACT_ADDRESS_HELPER' |translate }}
                                                        </small>
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                    <div class="row mt-1" formGroupName="deliveredTo">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <input class="form-control "
                                                    [ngClass]="{ 'is-invalid': submitted && f.dropOff.controls.deliveredTo.controls.name.errors }"
                                                    formControlName="name"
                                                    placeholder="{{ 'GENERAL.NAME' | translate }}">
                                                <small class="text-danger"
                                                    *ngIf=" f.dropOff.controls.deliveredTo.controls.name.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-group">
                                                <input class="form-control "
                                                    [ngClass]="{ 'is-invalid': submitted && f.dropOff.controls.deliveredTo.controls.email.errors }"
                                                    formControlName="email"
                                                    placeholder="{{ 'GENERAL.EMAIL' | translate }}">
                                                <small class="text-danger"
                                                    *ngIf=" f.dropOff.controls.deliveredTo.controls.email.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                                <small class="text-danger"
                                                    *ngIf=" f.dropOff.controls.deliveredTo.controls.email.hasError('pattern')">
                                                    Ce format de champ est incorrect
                                                </small>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group">
                                                <input class="form-control " pattern="[0-9 ]{8}" formControlName="phone"
                                                    [ngClass]="{ 'is-invalid': submitted && f.dropOff.controls.deliveredTo.controls.phone.errors }"
                                                    placeholder="{{ 'GENERAL.PHONE' | translate }}">


                                                <small class="text-danger"
                                                    *ngIf="f.dropOff.controls.deliveredTo.controls.phone.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>
                                                <small class="text-danger"
                                                    *ngIf="f.dropOff.controls.deliveredTo.controls.phone.hasError('pattern')">

                                                    Ce champ est numerique de longueur 8

                                                </small>







                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <select [ngClass]="{ 'is-invalid': submitted &&  f.city.errors}"
                                                formControlName="city" class="form-control "
                                                (change)="cityChanged($event)">
                                                <option selected="selected" disabled value="">
                                                    {{ 'GENERAL.CITY'|translate }}
                                                </option>
                                                <option value={{item.division}} *ngFor="let item of gouvernorats">
                                                    {{item.division}}
                                                </option>

                                            </select>
                                            <small class="text-danger" *ngIf="f.city.hasError('required')">
                                                Ce champ est obligatoire.
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <select [ngClass]="{ 'is-invalid': submitted &&  f.subDivision.errors}"
                                                formControlName="subDivision" class="form-control ">
                                                <option selected="selected" disabled value="">
                                                    Zone
                                                </option>
                                                <option value={{item}}
                                                    *ngFor="let item of gouvernorats[selectedDivision]?.subDivisions">
                                                    {{item}}
                                                </option>
                                                <option value="other">
                                                    other
                                                </option>
                                                <small class="text-danger" *ngIf="f.subDivision.hasError('required')">
                                                    Ce champ est obligatoire.
                                                </small>

                                            </select>

                                        </div>
                                    </div>

                                </div>


                                <div class="row mt-2 mb-5">
                                    <div class="col-12">
                                        <select class="form-control  "
                                            [ngClass]="{ 'is-invalid': submitted && f.status.errors }"
                                            formControlName="status">
                                            <option selected="selected" disabled value="">
                                                Status
                                            </option>
                                            <option value={{item.value}} *ngFor="let item of status">
                                                {{item.name }}
                                            </option>

                                        </select>
                                    </div>
                                </div>






                            </div>



                        </div>

                        <div class="card mt-2 mb-5 " *ngIf="jobType==1">

                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h4>
                                            {{ 'GENERAL.ADD_INFO' | translate }}
                                        </h4>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group">
                                            <textarea class="form-control " formControlName="addInfo" rows="5"
                                                [ngClass]="{ 'is-invalid': submitted && f.addInfo.errors }"
                                                placeholder="{{ 'GENERAL.ADD_INFO' | translate }}"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <div class="form-group">

                                            <textarea class="form-control " formControlName="descProduit" rows="5"
                                                [ngClass]="{ 'is-invalid': submitted && f.descProduit.errors }"
                                                placeholder="description du produit"></textarea>


                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>


                        <div class="row">
                            <div class="col requestFixedRow">
                                <button type="submit" [disabled]="disableSendBtn" (click)="saveRequestDelivery()"
                                    class="btn btn-info">

                                    <div *ngIf="disableSendBtn"
                                        class="spinner-border text-white mr-2 align-self-center loader-sm "></div>
                                    {{'LIVRAISON.SEND_REQUEST' | translate}}
                                </button>
                            </div>



                        </div>
                    </div>
                </form>
            </div>
            <div class="col-md-7">
                <div>
                    <div>
                        <agm-map style="
    height: 100vh;
    position: fixed;
    top: 0px;
    width: 69.333333%;
    background-color: rgb(229, 227, 223);
    " [latitude]="latitude" [longitude]="longitude" [scrollwheel]="true" [zoom]="zoom" [usePanning]="true">


                            <agm-marker *ngIf="jobType==1" style="height: 14px!important;"
                                [latitude]="f.pickUp.controls.latitude.value"
                                [longitude]="f.pickUp.controls.longitude.value" [iconUrl]="iconFrom
                                ">

                            </agm-marker>

                            <agm-marker *ngIf="jobType==2" style="height: 14px!important;"
                                [latitude]="f.dropOff.controls.latitude.value"
                                [longitude]="f.dropOff.controls.longitude.value" [iconUrl]="iconTo">

                            </agm-marker>

                        </agm-map>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade  bd-example-modal-lg" id="pickUpNameModal" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"> {{'LIVRAISON.NEW_ADDRESS_NAME' | translate}}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        {{'LIVRAISON.NEW_ADDRESS_TEXT' | translate}}
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <input [(ngModel)]="pname" class="form-control "
                                placeholder="{{'LIVRAISON.PICKUP_NAME' | translate}}">
                        </div>
                        <p *ngIf="pnameError" class="text-danger"> {{'LIVRAISON.PICKUP_NAME_ERROR' | translate}}
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" (click)="savePickUpName($event)" class="btn btn-primary">
                    {{'LIVRAISON.SAVE' | translate}}
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>